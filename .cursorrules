# 成分表分析 前処理プロジェクト ルール

## プロセス構造

各プロセスは以下の構造を持ちます：
- `process/{番号}-{名前}/index.ts` - プロセスの実装
- `process/{番号}-{名前}/readme.md` - プロセスの説明
- `process/{番号}-{名前}/result/` - 出力ファイル（自動生成）

## プロセス番号の命名規則

- プロセス番号は2桁のゼロ埋め表記を使用する（例：`00-`, `01-`, `02-`）
- これにより9段階を超えるプロセスにも対応できる

## プロセス作成の順序

1. まず`README.md`に処理の内容を記載する
2. その後、`process/{番号}-{名前}/`フォルダを作成し、実装を進める
3. プロセス作成が完了したら、`package.json`の`scripts`セクションに実行コマンドを追加する
4. この順序で段階的にプロセスを追加していく

## プロセス間の依存関係

効率よく処理するために、中間ファイルの生成が必要になる場合があります。

### 例：02-1と02-2の関係
- `02-1`で前処理を行い、`02-1/result/`に中間ファイルを出力
- `02-2`で本処理を行い、`02-2/result/`に最終的な出力結果を蓄積
- `02-2`は`02-1/result/`と`01-csv/result/`の両方の結果を参照する

### 一般的なルール
- 各プロセスは前のプロセスの`result/`フォルダを参照できる
- 複数のプロセスの`result/`を参照することも可能
- 各プロセスの出力は必ず`result/`フォルダに保存する
- 中間ファイルは必要に応じて作成し、後続のプロセスで利用する

## 技術スタック

- TypeScript (tsxで実行)
- Vercel AI SDK (OpenAIプロバイダ)
- dotenv (環境変数管理)
- xlsx (Excelファイル処理)

## AI使用時の料金表示

AIを使用するプロセスを作成する際は、以下のルールに従ってください：

- **料金計算ユーティリティの使用**: `utils/cost-calculator.ts`を使用して料金を計算・表示する
- **表示タイミング**: 各バッチ処理（またはAPI呼び出し）ごとに料金を表示する
- **表示内容**: 
  - トークン数（入力・出力）
  - 料金（USDとJPY）
  - 各バッチごとの料金を表示
- **モデル料金の定義**: `utils/cost-calculator.ts`の`MODEL_PRICING`にモデル別の料金を定義する
- **為替レート**: `utils/cost-calculator.ts`の`USD_TO_JPY`で変更可能（デフォルト: 150円）

